<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossOrigin="anonymous"/><style data-href="/app.506382439a4b4acdfe14.css">.fqxoyvp{display:var(--fqxoyvp-0);flex-direction:var(--fqxoyvp-1);justify-content:var(--fqxoyvp-2);align-content:var(--fqxoyvp-3);align-items:var(--fqxoyvp-4);width:var(--fqxoyvp-5);max-width:var(--fqxoyvp-5);padding:var(--fqxoyvp-7);flex-wrap:var(--fqxoyvp-8)}.m15xpxwi{color:#2b1d0e;-webkit-letter-spacing:2px;-moz-letter-spacing:2px;-ms-letter-spacing:2px;letter-spacing:2px;margin:0}@media screen and (max-width:40em){.m15xpxwi{font-size:20px}}@media screen and (max-width:20em){.m15xpxwi{font-size:18px}}.h10ud6k0{color:#2b1d0e;-webkit-letter-spacing:2px;-moz-letter-spacing:2px;-ms-letter-spacing:2px;letter-spacing:2px;margin:0}@media screen and (max-width:40em){.h10ud6k0{font-size:16px}}@media screen and (max-width:20em){.h10ud6k0{font-size:14px}}.h5wsek6{height:2rem;position:fixed;top:0;background:#f5f4e9;z-index:999;box-shadow:0 1px 3px rgba(0,0,0,.05);padding:16px 0;-webkit-text-decoration:none;text-decoration:none}.i4awmdj{cursor:pointer;color:#2b1d0e;font-size:1.5rem;margin-right:10px}.fpnldgf{height:4rem;box-shadow:0 -1px 3px rgba(0,0,0,.05)}.tw06ds8{text-align:center}@font-face{font-family:Lato;font-style:normal;font-weight:400;src:local("Lato Regular"),local("Lato-Regular"),url(/static/Lato-129179c4eeb1d784d3d3ad95e0b35905.woff2),url(https://fonts.gstatic.com/s/lato/v15/S6uyw4BMUTPHjx4wXiWtFCc.woff2) format("woff2");unicode-range:U+00??,U+0131,U+0152-0153,U+02bb-02bc,U+02c6,U+02da,U+02dc,U+2000-206f,U+2074,U+20ac,U+2122,U+2191,U+2193,U+2212,U+2215,U+feff,U+fffd}@font-face{font-family:Cormorant Garamond;font-style:normal;font-weight:400;src:local("Cormorant Garamond Regular"),local("CormorantGaramond-Regular"),url(/static/CormorantGaramond-5733ac592c848166a661326d6d7dd685.woff2),url(https://fonts.gstatic.com/s/cormorantgaramond/v6/co3bmX5slCNuHLi8bLeY9MK7whWMhyjYqXtKky2F7g.woff2) format("woff2");unicode-range:U+00??,U+0131,U+0152-0153,U+02bb-02bc,U+02c6,U+02da,U+02dc,U+2000-206f,U+2074,U+20ac,U+2122,U+2191,U+2193,U+2212,U+2215,U+feff,U+fffd}body{margin:0;padding:0;font-family:Lato;background:#f5f4e9;color:#2b1d0e;font-size:18px}h1,h2,h3,h4,h5,h6{font-family:Cormorant Garamond}h1,h2{margin-top:4rem}h2{font-weight:600}h3{margin-top:3rem}h4{margin-top:2rem}p{line-height:1.8}a{color:#519657}a,a:link,a:visited{text-decoration:none}a:active,a:hover{color:#38693c}pre{overflow:scroll;border-radius:4px;padding:10px 20px}pre,pre code{background:#444;color:#63e463}pre code{border:none;padding:0;border-radius:0;margin:0}code{color:#3eab3e;background:rgba(99,228,99,.1);border-radius:4px;padding:2px 4px;margin:0 4px}blockquote{border-left:6px solid rgba(179,195,180,.5);padding-left:32px;margin:32px 0}li{margin-bottom:8px}.m18vmv4p{padding:6rem 0 2rem}.m1p35dyn{max-width:80%;width:800px}</style><meta name="generator" content="Gatsby 2.0.31"/><title data-react-helmet="true"></title><link as="script" rel="preload" href="/component---src-templates-article-tsx-63d862aa3d1cb4f91eae.js"/><link as="script" rel="preload" href="/1-e3748de615d3fc364f58.js"/><link as="script" rel="preload" href="/app-8f18f59409f6882e8b2f.js"/><link as="script" rel="preload" href="/webpack-runtime-deb10267acc62a364733.js"/><link rel="preload" href="/static/d/172/path---blog-go-gotcha-nil-maps-738-a9a-4In8aleD6YVAdGlviTIC6dhwk.json" as="fetch" crossOrigin="use-credentials"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><div direction="column" class="fqxoyvp" style="--fqxoyvp-0:flex;--fqxoyvp-1:column;--fqxoyvp-2:initial;--fqxoyvp-3:initial;--fqxoyvp-4:initial;--fqxoyvp-5:100%;--fqxoyvp-7:0px;--fqxoyvp-8:nowrap"><div class="h5wsek6 fqxoyvp" style="--fqxoyvp-0:flex;--fqxoyvp-1:initial;--fqxoyvp-2:initial;--fqxoyvp-3:initial;--fqxoyvp-4:initial;--fqxoyvp-5:100%;--fqxoyvp-7:0px;--fqxoyvp-8:nowrap"><div class="fqxoyvp" style="--fqxoyvp-0:flex;--fqxoyvp-1:initial;--fqxoyvp-2:initial;--fqxoyvp-3:initial;--fqxoyvp-4:center;--fqxoyvp-5:50%;--fqxoyvp-7:0px 16px;--fqxoyvp-8:nowrap"><div style="display:flex;align-items:center"><a href="/"><h2 class="m15xpxwi">Keith Alpichi</h2></a></div></div><div class="fqxoyvp" style="--fqxoyvp-0:flex;--fqxoyvp-1:initial;--fqxoyvp-2:flex-end;--fqxoyvp-3:initial;--fqxoyvp-4:initial;--fqxoyvp-5:50%;--fqxoyvp-7:0px 16px;--fqxoyvp-8:nowrap"><a href="https://www.linkedin.com/in/keithalpichi" class="i4awmdj"><i class="fab fa-linkedin"></i></a><a href="https://github.com/keithalpichi" class="i4awmdj"><i class="fab fa-github-square"></i></a><div style="display:flex;align-items:center"><a href="/about"><h3 class="h10ud6k0">About</h3></a></div></div></div><div class="m18vmv4p fqxoyvp" direction="column" style="--fqxoyvp-0:flex;--fqxoyvp-1:column;--fqxoyvp-2:initial;--fqxoyvp-3:initial;--fqxoyvp-4:center;--fqxoyvp-5:100%;--fqxoyvp-7:0px 16px;--fqxoyvp-8:nowrap"><div class="m1p35dyn fqxoyvp" style="--fqxoyvp-0:initial;--fqxoyvp-1:initial;--fqxoyvp-2:initial;--fqxoyvp-3:initial;--fqxoyvp-4:initial;--fqxoyvp-5:100%;--fqxoyvp-7:0px 16px;--fqxoyvp-8:wrap"><h1 style="line-height:1">Go Gotcha: Nil Maps</h1><h3 style="color:#b3c3b4;margin-top:0">Monday, June 11th 2018</h3><div style="margin-top:64px"><p>A common beginner mistake in Go is forgetting to allocate the space for a <code>map</code>. Declaring variables with the map type will only default the <code>map</code> to <code>nil</code>. If you add an item to a <code>nil</code> map you will get a panic error. Let's see some examples of using maps correctly and incorrectly.</p>
<h2>How To Use Maps Incorrectly</h2>
<p>Consider this <code>map</code> declaration:</p>
<pre><code>var bankAccounts map[string]float64
</code></pre>
<p>We've declared the variable <code>bankAccounts</code> of type <code>map</code>. If we try to add an item to this <code>map</code> we'll get an error.</p>
<pre><code>bankAccounts["123-456"] = 100.00
panic: assignment to entry in nil map
</code></pre>
<p>Since we didn't initialize the map it is <code>nil</code> by default.</p>
<p>Consider this next example; another common mistake. We have this Person struct:</p>
<pre><code>type Person struct {
  Name string
  BankAccounts map[string]float64
}
</code></pre>
<p>Let's initialize a new Person, with only a name, and immediately add an item to the <code>Person.BankAccounts</code> map.</p>
<pre><code>p := Person{Name: "Keith"}
p.BankAccounts["123-456"] = 100.00
</code></pre>
<p>We initialized the struct so the map should be initialized as well, right? Let's build it and see if it succeeds.</p>
<pre><code>panic: assignment to entry in nil map
</code></pre>
<p>Whoops! No. The oversight here is not explicitly allocating and initializing the map. Again, we tried to add an item to a nil map and our program panicked. Now let's see how to handle maps correctly.</p>
<h2>How To Use Maps Correctly</h2>
<p>Maps, under the covers, reference data structures that must be initialized before use. There are two options we can pursue:</p>
<ul>
<li>use the built-in make function</li>
<li>use a map literal</li>
</ul>
<h3>The Built-In Make Function</h3>
<p>The definition of <code>make</code> is:</p>
<blockquote>
<p>Allocates and initializes an object of type slice, map, or chan (only). An empty map is allocated with enough space to hold the specified number of elements. The size may be omitted, in which case a small starting size is allocated.</p>
</blockquote>
<p>By simply calling this function with an initial capacity we can start utilizing the map immediately.</p>
<pre><code>var bankAccounts map[string]float64
bankAccounts = make(map[string]float64, 1)
bankAccounts["123-456"] = 100.00
</code></pre>
<p>We allocated and initialized a map with enough space to hold one element. We then successfully added a new element afterwards. Let's see the previous example where we used a Person struct type.</p>
<pre><code>p := Person{Name: "Keith"}
p.BankAccounts = make(map[string]float64, 1)
bankAccounts["123-456"] = 100.00
</code></pre>
<p>Once again we made sure we allocated and initialized the map. We can improve the previous example by initializing a map when we initial a Person.</p>
<pre><code>p := Person{Name: "Keith", BankAccounts: make(map[string]float64, 1)}
</code></pre>
<p>This will work as well; either way works. Using <code>make</code> is ideal when you know the number of elements will be added to the map.</p>
<h3>A Map Literal</h3>
<p>If we don't know the initial size we can omit the size in the <code>make</code> function or use a map literal instead.</p>
<pre><code>p := Person{Name: "Keith", BankAccounts: map[string]float64{} }
</code></pre>
<p>This is a smaller map that will grow as we add items to it.</p>
<p>Sometimes you may not want to or cannot immediately initialize a map when you initialize the struct it's contained within. In any case, you must do so when you first use the map.
Let's, again, initialize a new Person:</p>
<pre><code>p := Person{Name: "Keith"}
</code></pre>
<p>Later in your code you want to add an item to the <code>Person.BankAccounts</code> map. Before doing so you remember, or check, that it's nil so you initialize a new map using <code>make</code> or a map literal.</p>
<pre><code>bankAccts := make(map[string]float64, 2)
bankAccts["123-456"] = 100.00
bankAccts["456-789"] = 75.00
p.BankAccounts = bankAccts
</code></pre>
<h2>Make vs Map Literal?</h2>
<p>Most of the time you'll use <code>make</code>; especially if you know the number of elements you'll be adding to the map. Remember, the second argument to <code>make</code> is the initial size, not the max number of elements a map can hold. A map will grow as it's capacity gets fuller.</p>
<p>What if you don't know the number of elements, what do you provide as the initial size to make? You could use a small number, zero, or omit it entirely. Note that using zero or omitting the size (ie,<code>make(map[string]float64)</code>) is fundamentally the same as using map literals (ie, <code>map[string]float64{}</code>).</p>
<h2>Conclusion</h2>
<p>Forgetting to initialize maps is often overlooked. Just remember to always initialize maps when you can and check for nil maps (ie, compare the map to nil) to initialize maps before using them. Utilize the make function when you know the size.</p>
<p>🤙 Mahalo for reading!</p></div></div></div><div class="fpnldgf fqxoyvp" style="--fqxoyvp-0:flex;--fqxoyvp-1:initial;--fqxoyvp-2:center;--fqxoyvp-3:center;--fqxoyvp-4:initial;--fqxoyvp-5:100%;--fqxoyvp-7:0px;--fqxoyvp-8:nowrap"><div class="fqxoyvp" style="--fqxoyvp-0:initial;--fqxoyvp-1:initial;--fqxoyvp-2:initial;--fqxoyvp-3:initial;--fqxoyvp-4:initial;--fqxoyvp-5:100%;--fqxoyvp-7:0px 16px;--fqxoyvp-8:wrap"><p class="tw06ds8">Mahalo 🤙</p></div></div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-article-tsx","jsonName":"blog-go-gotcha-nil-maps-738","path":"/blog/go-gotcha-nil-maps"};window.dataPath="172/path---blog-go-gotcha-nil-maps-738-a9a-4In8aleD6YVAdGlviTIC6dhwk";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app.506382439a4b4acdfe14.css","/app-8f18f59409f6882e8b2f.js"],"component---src-templates-article-tsx":["/component---src-templates-article-tsx-63d862aa3d1cb4f91eae.js"],"component---src-templates-tags-tsx":["/component---src-templates-tags-tsx-e7819269c76effaddee6.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-695abf52f70b8b59c1c3.js"],"component---src-pages-about-tsx":["/component---src-pages-about-tsx-3805d29f82d6b81a1512.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx.5f018c0f41cc21e590cc.css","/component---src-pages-index-tsx-4ba1aab2715530bb72db.js"],"component---src-pages-tags-tsx":["/component---src-pages-tags-tsx-1dab9c7cbc6fe2ad05f4.js"]};/*]]>*/</script><script src="/webpack-runtime-deb10267acc62a364733.js" async=""></script><script src="/app-8f18f59409f6882e8b2f.js" async=""></script><script src="/1-e3748de615d3fc364f58.js" async=""></script><script src="/component---src-templates-article-tsx-63d862aa3d1cb4f91eae.js" async=""></script></body></html>