<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous"/><link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&amp;family=Roboto:ital,wght@0,300;0,400;0,700;0,900;1,500&amp;display=swap" rel="stylesheet"/><style data-href="/styles.dd504296c4fc23c7e4ca.css">/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}b,strong{font-weight:bolder}code{font-family:monospace,monospace;font-size:1em}small{font-size:80%}button{font-family:inherit;font-size:100%;line-height:1.15;margin:0;overflow:visible;text-transform:none;-webkit-appearance:button}button::-moz-focus-inner{border-style:none;padding:0}button:-moz-focusring{outline:1px dotted ButtonText}[hidden]{display:none}h1,h2,h3,p,pre{margin:0}button{background-color:transparent;background-image:none}button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}ul{margin:0;padding:0;list-style:none}html{font-family:Roboto,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;line-height:1.5}*{box-sizing:border-box;border:0 solid #e2e8f0}[role=button],button{cursor:pointer}h1,h2,h3{font-size:inherit;font-weight:inherit}a{text-decoration:inherit}a,button{color:inherit}button{padding:0;line-height:inherit}code,pre{font-family:Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}svg{display:block;vertical-align:middle}h1{line-height:1;font-size:2.25rem;--text-opacity:1;color:#f7c257;color:rgba(247,194,87,var(--text-opacity));font-family:Bebas Neue,Roboto,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;margin-top:3rem;margin-bottom:2rem}h2{font-size:1.875rem;margin-top:2rem}h2,h3{line-height:1;--text-opacity:1;color:#19445c;color:rgba(25,68,92,var(--text-opacity));font-family:Bebas Neue,Roboto,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;margin-bottom:1rem}h3{font-size:1.25rem;margin-top:1.5rem}@media (min-width:1024px){h1{font-size:4rem}h2{font-size:2.25rem}h3{font-size:1.5rem}}p{margin-top:1rem;margin-bottom:1rem;--text-opacity:1;color:#123346;color:rgba(18,51,70,var(--text-opacity))}li{margin-left:2rem;list-style-type:circle}code{padding:0 .25rem;margin:0}code,pre{white-space:pre-wrap;overflow:scroll;background:#19445c;color:#fff;border-radius:.125rem}pre{padding:.5rem;margin:2rem 0}.text-active{color:#88c4c8}.main{display:flex;flex-direction:column;margin:3rem auto auto;max-width:95%;width:75rem}#aloha{margin:16rem auto auto;max-width:90%;width:40rem}.wave{animation:wave 7s cubic-bezier(.36,.45,.63,.53) infinite;transform:translateZ(0)}.tags{display:flex;flex-direction:row;flex-wrap:wrap;margin-top:2.5rem;margin-bottom:2.5rem}.bg-transparent{background-color:transparent}.bg-cream{--bg-opacity:1;background-color:#fdf7ec;background-color:rgba(253,247,236,var(--bg-opacity))}.bg-burnt{--bg-opacity:1;background-color:#dc885d;background-color:rgba(220,136,93,var(--bg-opacity))}.bg-primary{--bg-opacity:1;background-color:#88c4c8;background-color:rgba(136,196,200,var(--bg-opacity))}.bg-secondary{--bg-opacity:1;background-color:#19445c;background-color:rgba(25,68,92,var(--bg-opacity))}.bg-success{--bg-opacity:1;background-color:#9ca97d;background-color:rgba(156,169,125,var(--bg-opacity))}.bg-danger{--bg-opacity:1;background-color:#dc885d;background-color:rgba(220,136,93,var(--bg-opacity))}.bg-info{--bg-opacity:1;background-color:#f7c257;background-color:rgba(247,194,87,var(--bg-opacity))}.hover\:border-white:hover{--border-opacity:1;border-color:#fff;border-color:rgba(255,255,255,var(--border-opacity))}.rounded{border-radius:.25rem}.rounded-md{border-radius:.375rem}.rounded-full{border-radius:9999px}.border{border-width:1px}.cursor-pointer{cursor:pointer}.block{display:block}.inline-block{display:inline-block}.flex{display:flex}.inline-flex{display:inline-flex}.grid{display:grid}.hidden{display:none}.flex-row{flex-direction:row}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-center{align-items:center}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.flex-grow{flex-grow:1}.flex-shrink-0{flex-shrink:0}.font-semibold{font-weight:600}.h-3{height:.75rem}.h-4{height:1rem}.text-sm{font-size:.875rem}.leading-5{line-height:1.25rem}.mx-2{margin-left:.5rem;margin-right:.5rem}.mt-0{margin-top:0}.mb-0{margin-bottom:0}.mr-4{margin-right:1rem}.mr-6{margin-right:1.5rem}.mb-12{margin-bottom:3rem}.mt-32{margin-top:8rem}.p-0{padding:0}.p-4{padding:1rem}.py-2{padding-top:.5rem;padding-bottom:.5rem}.px-2{padding-left:.5rem;padding-right:.5rem}.py-3{padding-top:.75rem;padding-bottom:.75rem}.px-3{padding-left:.75rem;padding-right:.75rem}.px-4{padding-left:1rem;padding-right:1rem}.fixed{position:fixed}.top-0{top:0}.right-0{right:0}.left-0{left:0}.fill-current{fill:currentColor}.text-center{text-align:center}.text-white{--text-opacity:1;color:#fff;color:rgba(255,255,255,var(--text-opacity))}.text-navy{--text-opacity:1;color:#19445c;color:rgba(25,68,92,var(--text-opacity))}.text-ocean{--text-opacity:1;color:#246183;color:rgba(36,97,131,var(--text-opacity))}.text-primary{--text-opacity:1;color:#88c4c8;color:rgba(136,196,200,var(--text-opacity))}.hover\:text-white:hover{--text-opacity:1;color:#fff;color:rgba(255,255,255,var(--text-opacity))}.w-3{width:.75rem}.w-4{width:1rem}.w-full{width:100%}.gap-x-0{grid-column-gap:0;column-gap:0}.gap-y-16{grid-row-gap:4rem;row-gap:4rem}.grid-cols-1{grid-template-columns:repeat(1,minmax(0,1fr))}.col-span-2{grid-column:span 2/span 2}@keyframes spin{to{transform:rotate(1turn)}}@keyframes ping{75%,to{transform:scale(2);opacity:0}}@keyframes pulse{50%{opacity:.5}}@keyframes bounce{0%,to{transform:translateY(-25%);animation-timing-function:cubic-bezier(.8,0,1,1)}50%{transform:none;animation-timing-function:cubic-bezier(0,0,.2,1)}}@keyframes wave{0%{margin-left:0}to{margin-left:-1600px}}@media (min-width:1024px){.lg\:bg-transparent{background-color:transparent}.lg\:block{display:block}.lg\:inline-block{display:inline-block}.lg\:flex{display:flex}.lg\:hidden{display:none}.lg\:flex-row{flex-direction:row}.lg\:items-center{align-items:center}.lg\:justify-end{justify-content:flex-end}.lg\:flex-grow{flex-grow:1}.lg\:h-8{height:2rem}.lg\:mt-0{margin-top:0}.lg\:py-0{padding-top:0;padding-bottom:0}.lg\:w-8{width:2rem}.lg\:w-auto{width:auto}.lg\:gap-x-12{grid-column-gap:3rem;column-gap:3rem}.lg\:grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.lg\:col-span-1{grid-column:span 1/span 1}}</style><meta name="generator" content="Gatsby 2.24.85"/><title data-react-helmet="true">Blog | What is an Express Middleware and How to Create One</title><link rel="icon" href="/favicon.svg?v=3e33d61cff0300426a5d0e1552cad9af" type="image/svg+xml"/><link rel="icon" href="/favicon-32x32.png?v=3e33d61cff0300426a5d0e1552cad9af" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=3e33d61cff0300426a5d0e1552cad9af"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=3e33d61cff0300426a5d0e1552cad9af"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=3e33d61cff0300426a5d0e1552cad9af"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=3e33d61cff0300426a5d0e1552cad9af"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=3e33d61cff0300426a5d0e1552cad9af"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=3e33d61cff0300426a5d0e1552cad9af"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=3e33d61cff0300426a5d0e1552cad9af"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=3e33d61cff0300426a5d0e1552cad9af"/><link as="script" rel="preload" href="/webpack-runtime-baea76c2dae03d1d4674.js"/><link as="script" rel="preload" href="/styles-755093da0c07f4b49226.js"/><link as="script" rel="preload" href="/framework-a445a942d18bd3dc90d1.js"/><link as="script" rel="preload" href="/app-e072e1a7bd3ce2690acf.js"/><link as="script" rel="preload" href="/ec00cb3cf49bfda73da655732e2bb5ae6d56dc86-e59a138c65365fd29065.js"/><link as="script" rel="preload" href="/c5d3cdb376881942a12d5213aa9a7735cfac92ef-f6f49297a1a856bddb11.js"/><link as="script" rel="preload" href="/component---src-templates-article-tsx-45d21322c7059c528474.js"/><link as="fetch" rel="preload" href="/page-data/blog/what-is-express-middleware-and-how-to-create-one/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body class="bg-cream"><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><nav class="fixed top-0 left-0 right-0 flex bg-burnt lg:bg-transparent items-center justify-between flex-wrap p-4"><div class="flex items-center flex-shrink-0 text-navy mr-6"><svg class="cursor-pointer fill-current text-navy" width="25" height="25" viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M16.6667 0H0L8.33333 16.6667L16.6667 0Z"></path><path d="M33.3333 0H16.6666L25 16.6667L33.3333 0Z"></path><path d="M50 0H33.3334L41.6667 16.6667L50 0Z"></path><path d="M16.6667 16.6667H0L8.33333 33.3333L16.6667 16.6667Z"></path><path d="M33.3333 16.6667H16.6666L25 33.3333L33.3333 16.6667Z"></path><path d="M50 16.6667H33.3334L41.6667 33.3333L50 16.6667Z"></path><path d="M16.6667 33.3333H0L8.33333 50L16.6667 33.3333Z"></path><path d="M33.3333 33.3333H16.6666L25 50L33.3333 33.3333Z"></path><path d="M50 33.3333H33.3334L41.6667 50L50 33.3333Z"></path></svg></div></nav><div class="main"><h1 class="mb-0">What is an Express Middleware and How to Create One</h1><p>Monday, July 17th, 2017</p><div class="tags"><span class="bg-transparent text-primary cursor-pointer px-2 inline-flex text-sm leading-5 font-semibold rounded-full">express</span><span class="bg-transparent text-primary cursor-pointer px-2 inline-flex text-sm leading-5 font-semibold rounded-full">nodejs</span></div><div><h4>Prerequisites</h4>
<ul>
<li>Basic understanding of the HTTP protocol, Javascript, Node, and Express</li>
</ul>
<h2>What are Middlewares?</h2>
<p>From the documentation,</p>
<blockquote>
<p>Middlewares are functions that have access to the request object (req), the response object (res), and the next function in the application’s request-response cycle. The next function is a function in the Express router which, when invoked, executes the middleware succeeding the current middleware.</p>
</blockquote>
<p>To give you a relatable picture, Express middleware's are the workers in a manufacturing line where each individual has a specific and unique responsibility. When a worker receives a product (request) from a previous worker they can do <strong>one</strong> of the following:</p>
<ul>
<li><strong>reject</strong> the product if it doesn't meet strict standards, thus the product ceases to continue down the production line</li>
<li><strong>add to or manipulate</strong> the product and/or <strong>allow</strong> the product to continue down the production line where the next worker (middleware) does their job</li>
</ul>
<p>If you've used Express before, you may have used some <a href="https://expressjs.com/en/resources/middleware.html">middlewares</a>:</p>
<ul>
<li>'body-parser'- parses the request body and places it into the 'req.body' key of the request object</li>
<li>'express.static'- serves your static files</li>
<li>'express.logger'- uses a logger</li>
</ul>
<p>All you had to do was add these to your Express application or route and BAM... you had more functionality! It seemed like magic but it's actually quite simple.</p>
<p>In this article I'll go over the details of middlewares and some useful examples showcasing the flexibility and power of middlewares.</p>
<h2>Req, Res, Next</h2>
<p>Middlewares have access to three things:</p>
<ul>
<li>the <a href="https://expressjs.com/en/4x/api.html#req">request</a> object</li>
<li>the <a href="https://expressjs.com/en/4x/api.html#res">response</a> object</li>
<li>the 'next' function</li>
</ul>
<pre><code class="language-go">function customMiddleware (req, res, next) {
  //...
}
</code></pre>
<p>Since you have access to the request and response you can do almost anything you want. You can extract or add information to and from either one. You would call 'next( )' if you want to continue the request and pass it on to the next middleware or end the request right there.</p>
<h2>Middleware Chain</h2>
<p>So you created the custom middleware, now what? You add it to the middleware chain. <strong>Middlewares are called in the order they're declared</strong>.</p>
<pre><code class="language-go">const express = require('express')
const app = express()
app.use(express.bodyParser)
app.use(customMiddleware)
</code></pre>
<p>On every request these two middlewares will run- 'bodyParser' will run first before the one below it</p>
<pre><code class="language-go">const express = require('express')
const app = express()
app.get('/some/path', customMiddleware, customMiddleware2)

const apiRouter = express.Router()
apiRouter.use(customMiddleware2)
app.use('/api', apiRouter)
</code></pre>
<p>You can have middlewares run on specific routes.</p>
<ul>
<li>'customMiddleware' will run first followed by 'customMiddleware2' for the 'GET' method on the path '/some/path'</li>
<li>Only 'customMiddleware2' will run for all requests to the 'apiRouter'</li>
</ul>
<p>Cool huh? Let's see some other useful examples!</p>
<h2>A Simple Logger- Log Date and URL Path</h2>
<p>In this example I extract and log some data specific to the request, then pass the request to the next middleware by using the 'next' function. The request or response is not altered in any way. I'll show an example of that next.</p>
<pre><code class="language-go">function datePathLogger (req, res, next) {
  const date = new Date().toUTCString()
  console.log(`Request to '${req.path}' on ${date}`)
  next()
}
</code></pre>
<p>A request to a url 'www.foo.com/bar' would log</p>
<pre><code class="language-bash">Request to '/bar' on Mon, 17 Jul 2017 01:01:38 GMT
</code></pre>
<p>After the 'console.log' function ran the 'next' function was called. At this point the request and response would be handed to the next middleware.</p>
<h2>Token Parser- Parse User ID from JWT Token</h2>
<p>In this example I parse the request object for the JWT token to get the user's id. If it doesn't exist or the token was invalid I end the request and send back an unauthorized status code of 401. At this point the request stops. If it does exist I place the user's id into 'req.user_id' then call 'next'.</p>
<blockquote>
<p>Note that the key 'user<em>id' is arbitrary. I could have used 'req.users</em>identification_number'. However, there are reserved keys on the request and response object that you shouldn't modify. So consult the documentation to verify you're not modifying reserved keys.</p>
</blockquote>
<pre><code class="language-go">function tokenParser (req, res, next) {
  const user_id = parseTokenForUserID(req) // This is a made-up function that parses the user's ID from the request object
  if (!user_id) {
    res.sendStatus(401)
  } else {
    req.user_id = user_id
    next()
  }
}
</code></pre>
<p>Now in every succeeding middleware or request handler I have access to the user's id at 'req.user_id'.</p>
<h2>Environment-specific Middleware</h2>
<p>Since middleware's are just functions you can have functionality based on different environments or configuration. Say, for example, we wanted to perform descriptive logging for development environments.</p>
<pre><code class="language-go">function logger (env) {
  if (env === 'development') {
    return function (req, res, next) {
      // perform descriptive logs better suited for development environments
    }
  } else {
    return function (req, res, next) {
      // perform none or minimal logging
    }
  }
}
</code></pre>
<p>Then add this middleware by <strong>calling</strong> it with the environment</p>
<pre><code class="language-go">const express = require('express')
const app = express()
app.use(logger(process.env.NODE_ENV))
</code></pre>
<p>These may not be practical examples you'd actually use in production but the illustrations should provide some clarity on the flexibility of middlewares.</p>
<h2>Beauty Of Middlewares</h2>
<p>I love how the flow in Express middleware's are very explicit. It makes code intuitive, super flexible, and easy to read. If you're not creating custom middlewares I highly encourage you take advantage of their simplicity and power.</p>
<p>If you have any comments or questions please tweet me!</p></div><p>Thank you for reading my article. Make sure to check out some related articles by following one of the tags below.</p><div class="tags"><span class="bg-transparent text-primary cursor-pointer px-2 inline-flex text-sm leading-5 font-semibold rounded-full">all tags</span><span class="bg-transparent text-primary cursor-pointer px-2 inline-flex text-sm leading-5 font-semibold rounded-full">express</span><span class="bg-transparent text-primary cursor-pointer px-2 inline-flex text-sm leading-5 font-semibold rounded-full">nodejs</span></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/what-is-express-middleware-and-how-to-create-one";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-140e3b63fc9834dd4e0f.js"],"app":["/app-e072e1a7bd3ce2690acf.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-a6eb387dc88ff32c3d41.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-adce03e864a54a1ccf21.js"],"component---src-templates-article-tsx":["/component---src-templates-article-tsx-45d21322c7059c528474.js"],"component---src-templates-tags-tsx":["/component---src-templates-tags-tsx-036cd4c71a6991218b9c.js"]};/*]]>*/</script><script src="/polyfill-140e3b63fc9834dd4e0f.js" nomodule=""></script><script src="/component---src-templates-article-tsx-45d21322c7059c528474.js" async=""></script><script src="/c5d3cdb376881942a12d5213aa9a7735cfac92ef-f6f49297a1a856bddb11.js" async=""></script><script src="/ec00cb3cf49bfda73da655732e2bb5ae6d56dc86-e59a138c65365fd29065.js" async=""></script><script src="/app-e072e1a7bd3ce2690acf.js" async=""></script><script src="/framework-a445a942d18bd3dc90d1.js" async=""></script><script src="/styles-755093da0c07f4b49226.js" async=""></script><script src="/webpack-runtime-baea76c2dae03d1d4674.js" async=""></script></body></html>